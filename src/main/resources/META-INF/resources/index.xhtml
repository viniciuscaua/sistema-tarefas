<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Gerenciador de Tarefas</title>
    <h:outputStylesheet library="webjars" name="primeflex/3.3.0/primeflex.min.css" />
    <style type="text/css">
        .task-form .ui-panel-content {
            padding: 2rem !important;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .task-form .form-grid {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 1rem;
            align-items: center;
            width: 100%;
            max-width: 600px;
        }
        .task-form .form-grid .ui-outputlabel {
            justify-self: end;
            font-weight: bold;
        }
        .task-form .form-grid .ui-inputtext,
        .task-form .form-grid .ui-inputtextarea,
        .task-form .form-grid .ui-selectonemenu {
            width: 100%;
            max-width: 400px;
        }
        .task-form .button-container {
            margin-top: 1rem;
            width: 100%;
            max-width: 600px;
            padding-left: 120px;
            text-align: left;
        }
    </style>
</h:head>

<h:body>
    <div class="card">
        <h:form id="form">
            <p:growl id="messages" showDetail="true"/>
            
            <p:panel header="Cadastrar Tarefa" styleClass="task-form">
                <div class="form-grid">
                    <p:outputLabel for="titulo" value="Título:"/>
                    <p:inputText id="titulo" value="#{taskController.task.titulo}" required="true"/>
                    
                    <p:outputLabel for="descricao" value="Descrição:"/>
                    <p:inputTextarea id="descricao" value="#{taskController.task.descricao}" rows="3"/>
                    
                    <p:outputLabel for="responsavel" value="Responsável:"/>
                    <p:selectOneMenu id="responsavel" value="#{taskController.task.responsavel}" required="true">
                        <f:selectItem itemLabel="Select" noSelectionOption="true"/>
                        <f:selectItem itemLabel="João" itemValue="João"/>
                        <f:selectItem itemLabel="Maria" itemValue="Maria"/>
                        <f:selectItem itemLabel="Pedro" itemValue="Pedro"/>
                    </p:selectOneMenu>
                    
                    <p:outputLabel for="prioridade" value="Prioridade:"/>
                    <p:selectOneMenu id="prioridade" value="#{taskController.task.prioridade}" required="true">
                        <f:selectItem itemLabel="Select" noSelectionOption="true"/>
                        <f:selectItem itemLabel="Alta" itemValue="ALTA"/>
                        <f:selectItem itemLabel="Média" itemValue="MEDIA"/>
                        <f:selectItem itemLabel="Baixa" itemValue="BAIXA"/>
                    </p:selectOneMenu>
                    
                    <p:outputLabel for="deadline" value="Deadline:"/>
                    <p:datePicker id="deadline" value="#{taskController.task.deadline}" required="true"
                                pattern="dd/MM/yyyy" showIcon="true"/>
                </div>
                
                <div class="button-container">
                    <p:commandButton value="Cadastrar" action="#{taskController.salvar}" 
                                   update="form" styleClass="ui-button-primary"/>
                                   
                    <p:commandButton value="Cancelar" action="#{taskController.cancelarEdicao}" 
                                   update="form" rendered="#{taskController.task.id != null}"
                                   styleClass="ui-button-secondary"
                                   style="margin-left: 0.5rem;"
                                   immediate="true"/>
                </div>
            </p:panel>
            
            <p:panel header="Filtros" style="margin-top: 20px;" id="painelFiltros">
                <h:panelGrid columns="2" cellpadding="5">
                    <p:outputLabel for="filtroNumero" value="Número:"/>
                    <p:inputNumber id="filtroNumero" value="#{taskController.filtro.id}" 
                                 decimalPlaces="0" thousandSeparator=""/>
                    
                    <p:outputLabel for="filtroTituloDesc" value="Título/Descrição:"/>
                    <p:inputText id="filtroTituloDesc" value="#{taskController.filtro.titulo}"/>
                    
                    <p:outputLabel for="filtroResponsavel" value="Responsável:"/>
                    <p:selectOneMenu id="filtroResponsavel" value="#{taskController.filtro.responsavel}">
                        <f:selectItem itemLabel="Selecione..." itemValue="#{null}"/>
                        <f:selectItem itemLabel="João" itemValue="João"/>
                        <f:selectItem itemLabel="Maria" itemValue="Maria"/>
                        <f:selectItem itemLabel="Pedro" itemValue="Pedro"/>
                    </p:selectOneMenu>

                    <p:outputLabel for="filtroSituacao" value="Situação:"/>
                    <p:selectOneMenu id="filtroSituacao" value="#{taskController.filtro.situacao}">
                        <f:selectItem itemLabel="Selecione..." itemValue="#{null}"/>
                        <f:selectItem itemLabel="Em andamento" itemValue="EM_ANDAMENTO"/>
                        <f:selectItem itemLabel="Concluída" itemValue="CONCLUIDA"/>
                    </p:selectOneMenu>
                </h:panelGrid>
                
                <div style="margin-top: 10px;">
                    <p:commandButton value="Filtrar" action="#{taskController.filtrar}" 
                                   update="tabelaTarefas messages"
                                   style="margin-right: 5px;"
                                   process="painelFiltros @this"/>
                                   
                    <p:commandButton value="Limpar Filtros" action="#{taskController.limparFiltros}" 
                                   update="painelFiltros tabelaTarefas messages"
                                   styleClass="ui-button-secondary"
                                   process="@this"/>
                </div>
            </p:panel>
            
            <p:dataTable id="tabelaTarefas" value="#{taskController.tasks}" var="task"
                        style="margin-top: 20px;" emptyMessage="Nenhuma tarefa encontrada">
                <p:column headerText="Número" style="width: 80px;">
                    <h:outputText value="#{task.id}"/>
                </p:column>

                <p:column headerText="Título">
                    <h:outputText value="#{task.titulo}"/>
                    <br/>
                    <h:outputText value="#{task.descricao}" style="font-size: 0.9em; color: #666;"/>
                </p:column>
                
                <p:column headerText="Responsável">
                    <h:outputText value="#{task.responsavel}"/>
                </p:column>
                
                <p:column headerText="Prioridade">
                    <h:outputText value="#{task.prioridade.descricao}"/>
                </p:column>
                
                <p:column headerText="Deadline">
                    <h:outputText value="#{task.deadline}">
                        <f:convertDateTime pattern="dd/MM/yyyy" type="localDate"/>
                    </h:outputText>
                </p:column>
                
                <p:column headerText="Situação">
                    <h:outputText value="#{task.situacao.descricao}"/>
                </p:column>
                
                <p:column headerText="Ações" style="width:130px;text-align: center">
                    <p:commandButton icon="pi pi-check" action="#{taskController.concluirTarefa(task)}"
                                   update="form" styleClass="ui-button-success"
                                   style="margin-right: 5px;"
                                   rendered="#{task.situacao == 'EM_ANDAMENTO'}"
                                   title="Concluir"
                                   process="@this"
                                   immediate="true">
                        <p:confirm type="popup" header="Confirmação" 
                                 message="Tem certeza que deseja concluir esta tarefa?" 
                                 icon="pi pi-exclamation-triangle"/>
                    </p:commandButton>
                    
                    <p:commandButton icon="pi pi-pencil" action="#{taskController.editar(task)}"
                                   update="form" immediate="true" process="@this"
                                   styleClass="ui-button-warning"
                                   style="margin-right: 5px;"
                                   rendered="#{task.situacao == 'EM_ANDAMENTO'}"
                                   title="Editar"/>
                                   
                    <p:commandButton icon="pi pi-trash" styleClass="ui-button-danger"
                                   title="Excluir">
                        <p:confirm type="popup" header="Confirmação" 
                                 message="Tem certeza que deseja excluir esta tarefa?" 
                                 icon="pi pi-exclamation-triangle"/>
                        <p:ajax listener="#{taskController.excluir(task)}" update="form"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>
            
            <p:confirmPopup global="true">
                <p:commandButton value="Não" type="button" 
                               styleClass="ui-confirm-popup-no ui-button-flat"/>
                <p:commandButton value="Sim" type="button" 
                               styleClass="ui-confirm-popup-yes"/>
            </p:confirmPopup>
        </h:form>
    </div>
</h:body>
</html> 